Propuesta pagina para redireccionar según el rol:

<?php

require_once 'auth.php'; // Incluye auth.php para asegurarse de que la autenticación se realiza primero

function redirectBasedOnRole() {
    global $role;

    $currentPage = basename($_SERVER['SCRIPT_FILENAME']);
    
    // Si el usuario está autenticado pero intenta acceder a log.php
    if (isset($_SESSION['user_id']) && $currentPage === 'log.php') {
        header("Location: perfil.php");
        exit();
    }

    // Páginas y los roles que se requieren para acceder a ellas
    $roleRequiredPages = [
        'perfil.php' => ['Administrador', 'Cajero', 'Usuario'],
        'public/frontend/index.php' => ['Administrador', 'Cajero'],
        'public/frontend/productos.php' => ['Administrador', 'Cajero', 'Usuario'],
        'public/frontend/usuarios.php' => ['Administrador']
    ];
    
    // Verifica si la página actual requiere un rol específico
    if (isset($roleRequiredPages[$currentPage])) {
        // Si el rol es 'Invitado' o no se tiene acceso a la página, redirige a la página principal
        if ($role === 'Invitado' || !checkAccess($currentPage)) {
            header("Location: /tiendadb/index.php");
            exit();
        }
    }
}

function checkAccess($page) {
    global $role;

    // Control de acceso para diferentes páginas
    $accessControl = [
        'index.php' => ['Administrador', 'Cajero', 'Usuario', 'Invitado'],
        'log.php' => ['Administrador', 'Cajero', 'Usuario', 'Invitado'],
        'perfil.php' => ['Administrador', 'Cajero', 'Usuario'],
        'sobrenosotros.php' => ['Administrador', 'Cajero', 'Usuario', 'Invitado'],
        'ventas.php' => ['Administrador', 'Cajero', 'Usuario', 'Invitado'],
        'public/frontend/index.php' => ['Administrador', 'Cajero'],
        'public/frontend/productos.php' => ['Administrador', 'Cajero', 'Usuario'],
        'public/frontend/usuarios.php' => ['Administrador'],
        'public/error/response.html' => ['Administrador', 'Cajero', 'Usuario']
    ];

    // Esto verifica si la página está en el control de acceso y si el rol del usuario está permitido
    if (isset($accessControl[$page])) {
        return in_array($role, $accessControl[$page]);
    }
    return false;
}

// Función para cerrar sesión
if (isset($_GET['action']) && $_GET['action'] === 'logout') {
    session_unset(); // Elimina todas las variables de sesión
    session_destroy(); // Destruye la sesión
    setcookie(session_name(), '', time() - 3600, '/'); // Elimina la cookie de sesión

    // Para depuración: Verifica si la sesión fue eliminada
    if (session_status() == PHP_SESSION_NONE) {
        echo 'Sesión destruida.';
    } else {
        echo 'Error al destruir la sesión.';
    }

    header("Location: /tiendadb/index.php");
    exit();
}

redirectBasedOnRole(); // Llama a la función para redirigir basado en el rol del usuario
?>



auth.php:

Si no hay un usuario autenticado, se asigna username y role a "Invitado" y userId a null.
Se guarda esta información en una variable global $GLOBALS['sessionData'] para su uso en el frontend.
redirect.php:

Se incluye auth.php para obtener los datos de autenticación.
La función redirectBasedOnRole() verifica si la página actual requiere un rol específico y si el usuario autenticado tiene el rol necesario.
Si el rol del usuario es "Invitado" o el usuario no tiene acceso a la página actual, redirige a la página principal.
La función checkAccess() define qué roles tienen acceso a qué páginas.
Se incluye una verificación para cerrar la sesión si se pasa action=logout en la URL.
Finalmente, se llama a redirectBasedOnRole() para manejar las redirecciones basadas en el rol del usuario.
Acceso por Roles
Invitado: Acceso solo a index.php, log.php, sobrenosotros.php, y ventas.php.
Usuario: Acceso a todas las páginas excepto las que están dentro de public.
Cajero: Acceso a todas las páginas excepto public/frontend/usuarios.php y public/frontend/index.php.
Administrador: Acceso a todas las páginas.